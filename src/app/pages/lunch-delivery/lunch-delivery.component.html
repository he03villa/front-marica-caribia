<div class="scanner-container">
  <h2>Lector de CÃ³digos de Barras</h2>

  <div *ngIf="!hasPermission" class="alert alert-warning">
    <p>Se necesitan permisos de cÃ¡mara para usar el lector de cÃ³digos de barras.</p>
    <button (click)="checkPermissions()" class="btn btn-primary">
      Solicitar Permisos
    </button>
  </div>

  <div *ngIf="!hasDevices && hasPermission" class="alert alert-danger">
    <p>No se encontraron dispositivos de cÃ¡mara.</p>
  </div>

  <div *ngIf="hasDevices && hasPermission" class="controls">
    <div class="device-selector">
      <label for="deviceSelect">Seleccionar CÃ¡mara:</label>
      <select id="deviceSelect"
              [value]="currentDevice?.deviceId"
              (change)="onDeviceSelectChange($event)">
        <option *ngFor="let device of availableDevices"
                [value]="device.deviceId">
          {{ device.label || 'CÃ¡mara ' + device.deviceId }}
        </option>
      </select>
    </div>

    <div class="scanner-controls">
      <button *ngIf="!scannerEnabled"
              (click)="startScanner()"
              class="btn btn-success">
        ğŸ“· Iniciar Lector
      </button>
      <button *ngIf="scannerEnabled"
              (click)="stopScanner()"
              class="btn btn-danger">
        â¹ï¸ Detener Lector
      </button>
      <button *ngIf="scanResult"
              (click)="clearResult()"
              class="btn btn-secondary">
        ğŸ—‘ï¸ Limpiar
      </button>
    </div>
  </div>

  <div *ngIf="scannerEnabled && hasPermission && hasDevices" class="scanner-wrapper">
    <div class="scanner-guide">
      <p>ğŸ“± Apunta la cÃ¡mara hacia el cÃ³digo de barras</p>
      <p>ğŸ¯ MantÃ©n el cÃ³digo dentro del marco</p>
    </div>

    <zxing-scanner
      #scanner
      [enable]="scannerEnabled"
      [device]="currentDevice"
      [formats]="allowedFormats"
      (scanSuccess)="onCodeResult($event)"
      (scanError)="onScanError($event)"
      (camerasFound)="onCamerasFound($event)"
      (hasPermission)="onHasPermission($event)">
    </zxing-scanner>
  </div>

  <div *ngIf="scanResult" class="barcode-info">
    <h3>ğŸ·ï¸ CÃ³digo de Barras Detectado</h3>

    <div class="barcode-details">
      <div class="detail-item">
        <strong>CÃ³digo:</strong>
        <span class="barcode-value">{{ scanResult }}</span>
        <button (click)="copyToClipboard(scanResult)"
                class="btn-copy" title="Copiar cÃ³digo">
          ğŸ“‹
        </button>
      </div>

      <div class="detail-item">
        <strong>Tipo:</strong>
        <span class="barcode-type">{{ barcodeType }}</span>
      </div>
    </div>

    <div *ngIf="productInfo && (barcodeType.includes('EAN') || barcodeType.includes('UPC'))"
         class="product-info">
      <h4>ğŸ“¦ InformaciÃ³n del Producto</h4>
      <div class="product-details">
        <p><strong>Nombre:</strong> {{ productInfo.name }}</p>
        <p><strong>Marca:</strong> {{ productInfo.brand }}</p>
        <p><strong>CategorÃ­a:</strong> {{ productInfo.category }}</p>
        <p><strong>Precio:</strong> {{ productInfo.price }}</p>
        <p><strong>DescripciÃ³n:</strong> {{ productInfo.description }}</p>
      </div>
    </div>

    <div *ngIf="productInfo && (!barcodeType.includes('EAN') && !barcodeType.includes('UPC'))"
         class="general-info">
      <h4>â„¹ï¸ InformaciÃ³n del CÃ³digo</h4>
      <div class="general-details">
        <p><strong>Datos:</strong> {{ productInfo.data }}</p>
        <p><strong>Escaneado:</strong> {{ productInfo.timestamp }}</p>
      </div>
    </div>
  </div>

  <div *ngIf="scanHistory.length > 0" class="scan-history">
    <div class="history-header">
      <h3>ğŸ“‹ Historial de CÃ³digos</h3>
      <button (click)="clearHistory()" class="btn btn-outline-secondary btn-sm">
        ğŸ—‘ï¸ Limpiar Historial
      </button>
    </div>

    <div class="history-list">
      <div *ngFor="let item of scanHistory" class="history-item">
        <div class="history-info">
          <div class="history-code">{{ item.code }}</div>
          <div class="history-type">{{ item.type }}</div>
          <div class="history-time">{{ item.timestamp }}</div>
        </div>
        <button (click)="rescanBarcode(item.code)"
                class="btn-rescan"
                title="Ver detalles">
          ğŸ‘ï¸
        </button>
      </div>
    </div>
  </div>

  <div class="info-section">
    <h4>ğŸ“š Tipos de CÃ³digos Soportados</h4>
    <div class="supported-formats">
      <span class="format-tag">EAN-13</span>
      <span class="format-tag">EAN-8</span>
      <span class="format-tag">UPC-A</span>
      <span class="format-tag">UPC-E</span>
      <span class="format-tag">Code 128</span>
      <span class="format-tag">Code 39</span>
      <span class="format-tag">Code 93</span>
      <span class="format-tag">ITF</span>
      <span class="format-tag">Codabar</span>
    </div>
  </div>
</div>